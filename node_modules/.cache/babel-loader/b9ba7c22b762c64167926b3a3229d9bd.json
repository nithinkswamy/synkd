{"ast":null,"code":"import { __awaiter, __extends, __generator } from \"tslib\";\nimport { WebPlugin } from './index';\nimport { CameraResultType, CameraDirection, CameraSource } from '../core-plugin-definitions';\nvar CameraPluginWeb = /** @class */function (_super) {\n  __extends(CameraPluginWeb, _super);\n  function CameraPluginWeb() {\n    return _super.call(this, {\n      name: 'Camera',\n      platforms: ['web']\n    }) || this;\n  }\n  CameraPluginWeb.prototype.getPhoto = function (options) {\n    return __awaiter(this, void 0, void 0, function () {\n      var _this = this;\n      return __generator(this, function (_a) {\n        return [2 /*return*/, new Promise(function (resolve, reject) {\n          return __awaiter(_this, void 0, void 0, function () {\n            var cameraModal_1, e_1;\n            var _this = this;\n            return __generator(this, function (_a) {\n              switch (_a.label) {\n                case 0:\n                  if (!options.webUseInput) return [3 /*break*/, 1];\n                  this.fileInputExperience(options, resolve);\n                  return [3 /*break*/, 7];\n                case 1:\n                  if (!customElements.get('pwa-camera-modal')) return [3 /*break*/, 6];\n                  cameraModal_1 = document.createElement('pwa-camera-modal');\n                  document.body.appendChild(cameraModal_1);\n                  _a.label = 2;\n                case 2:\n                  _a.trys.push([2, 4,, 5]);\n                  return [4 /*yield*/, cameraModal_1.componentOnReady()];\n                case 3:\n                  _a.sent();\n                  cameraModal_1.addEventListener('onPhoto', function (e) {\n                    return __awaiter(_this, void 0, void 0, function () {\n                      var photo, _a;\n                      return __generator(this, function (_b) {\n                        switch (_b.label) {\n                          case 0:\n                            photo = e.detail;\n                            if (!(photo === null)) return [3 /*break*/, 1];\n                            reject('User cancelled photos app');\n                            return [3 /*break*/, 4];\n                          case 1:\n                            if (!(photo instanceof Error)) return [3 /*break*/, 2];\n                            reject(photo.message);\n                            return [3 /*break*/, 4];\n                          case 2:\n                            _a = resolve;\n                            return [4 /*yield*/, this._getCameraPhoto(photo, options)];\n                          case 3:\n                            _a.apply(void 0, [_b.sent()]);\n                            _b.label = 4;\n                          case 4:\n                            cameraModal_1.dismiss();\n                            document.body.removeChild(cameraModal_1);\n                            return [2 /*return*/];\n                        }\n                      });\n                    });\n                  });\n\n                  cameraModal_1.present();\n                  return [3 /*break*/, 5];\n                case 4:\n                  e_1 = _a.sent();\n                  this.fileInputExperience(options, resolve);\n                  return [3 /*break*/, 5];\n                case 5:\n                  return [3 /*break*/, 7];\n                case 6:\n                  console.error(\"Unable to load PWA Element 'pwa-camera-modal'. See the docs: https://capacitorjs.com/docs/pwa-elements.\");\n                  this.fileInputExperience(options, resolve);\n                  _a.label = 7;\n                case 7:\n                  return [2 /*return*/];\n              }\n            });\n          });\n        })];\n      });\n    });\n  };\n\n  CameraPluginWeb.prototype.fileInputExperience = function (options, resolve) {\n    var input = document.querySelector('#_capacitor-camera-input');\n    var cleanup = function () {\n      input.parentNode && input.parentNode.removeChild(input);\n    };\n    if (!input) {\n      input = document.createElement('input');\n      input.id = '_capacitor-camera-input';\n      input.type = 'file';\n      document.body.appendChild(input);\n    }\n    input.accept = 'image/*';\n    input.capture = true;\n    if (options.source === CameraSource.Photos || options.source === CameraSource.Prompt) {\n      input.removeAttribute('capture');\n    } else if (options.direction === CameraDirection.Front) {\n      input.capture = 'user';\n    } else if (options.direction === CameraDirection.Rear) {\n      input.capture = 'environment';\n    }\n    input.addEventListener('change', function (_e) {\n      var file = input.files[0];\n      var format = 'jpeg';\n      if (file.type === 'image/png') {\n        format = 'png';\n      } else if (file.type === 'image/gif') {\n        format = 'gif';\n      }\n      if (options.resultType === CameraResultType.DataUrl || options.resultType === CameraResultType.Base64) {\n        var reader_1 = new FileReader();\n        reader_1.addEventListener('load', function () {\n          if (options.resultType === CameraResultType.DataUrl) {\n            resolve({\n              dataUrl: reader_1.result,\n              format: format\n            });\n          } else if (options.resultType === CameraResultType.Base64) {\n            var b64 = reader_1.result.split(',')[1];\n            resolve({\n              base64String: b64,\n              format: format\n            });\n          }\n          cleanup();\n        });\n        reader_1.readAsDataURL(file);\n      } else {\n        resolve({\n          webPath: URL.createObjectURL(file),\n          format: format\n        });\n        cleanup();\n      }\n    });\n    input.click();\n  };\n  CameraPluginWeb.prototype._getCameraPhoto = function (photo, options) {\n    return new Promise(function (resolve, reject) {\n      var reader = new FileReader();\n      var format = photo.type.split('/')[1];\n      if (options.resultType === CameraResultType.Uri) {\n        resolve({\n          webPath: URL.createObjectURL(photo),\n          format: format\n        });\n      } else {\n        reader.readAsDataURL(photo);\n        reader.onloadend = function () {\n          var r = reader.result;\n          if (options.resultType === CameraResultType.DataUrl) {\n            resolve({\n              dataUrl: r,\n              format: format\n            });\n          } else {\n            resolve({\n              base64String: r.split(',')[1],\n              format: format\n            });\n          }\n        };\n        reader.onerror = function (e) {\n          reject(e);\n        };\n      }\n    });\n  };\n  return CameraPluginWeb;\n}(WebPlugin);\nexport { CameraPluginWeb };\nvar Camera = new CameraPluginWeb();\nexport { Camera };","map":{"version":3,"sources":["../../../src/web/camera.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["import { __awaiter, __extends, __generator } from \"tslib\";\nimport { WebPlugin } from './index';\nimport { CameraResultType, CameraDirection, CameraSource } from '../core-plugin-definitions';\nvar CameraPluginWeb = /** @class */ (function (_super) {\n    __extends(CameraPluginWeb, _super);\n    function CameraPluginWeb() {\n        return _super.call(this, {\n            name: 'Camera',\n            platforms: ['web']\n        }) || this;\n    }\n    CameraPluginWeb.prototype.getPhoto = function (options) {\n        return __awaiter(this, void 0, void 0, function () {\n            var _this = this;\n            return __generator(this, function (_a) {\n                return [2 /*return*/, new Promise(function (resolve, reject) { return __awaiter(_this, void 0, void 0, function () {\n                        var cameraModal_1, e_1;\n                        var _this = this;\n                        return __generator(this, function (_a) {\n                            switch (_a.label) {\n                                case 0:\n                                    if (!options.webUseInput) return [3 /*break*/, 1];\n                                    this.fileInputExperience(options, resolve);\n                                    return [3 /*break*/, 7];\n                                case 1:\n                                    if (!customElements.get('pwa-camera-modal')) return [3 /*break*/, 6];\n                                    cameraModal_1 = document.createElement('pwa-camera-modal');\n                                    document.body.appendChild(cameraModal_1);\n                                    _a.label = 2;\n                                case 2:\n                                    _a.trys.push([2, 4, , 5]);\n                                    return [4 /*yield*/, cameraModal_1.componentOnReady()];\n                                case 3:\n                                    _a.sent();\n                                    cameraModal_1.addEventListener('onPhoto', function (e) { return __awaiter(_this, void 0, void 0, function () {\n                                        var photo, _a;\n                                        return __generator(this, function (_b) {\n                                            switch (_b.label) {\n                                                case 0:\n                                                    photo = e.detail;\n                                                    if (!(photo === null)) return [3 /*break*/, 1];\n                                                    reject('User cancelled photos app');\n                                                    return [3 /*break*/, 4];\n                                                case 1:\n                                                    if (!(photo instanceof Error)) return [3 /*break*/, 2];\n                                                    reject(photo.message);\n                                                    return [3 /*break*/, 4];\n                                                case 2:\n                                                    _a = resolve;\n                                                    return [4 /*yield*/, this._getCameraPhoto(photo, options)];\n                                                case 3:\n                                                    _a.apply(void 0, [_b.sent()]);\n                                                    _b.label = 4;\n                                                case 4:\n                                                    cameraModal_1.dismiss();\n                                                    document.body.removeChild(cameraModal_1);\n                                                    return [2 /*return*/];\n                                            }\n                                        });\n                                    }); });\n                                    cameraModal_1.present();\n                                    return [3 /*break*/, 5];\n                                case 4:\n                                    e_1 = _a.sent();\n                                    this.fileInputExperience(options, resolve);\n                                    return [3 /*break*/, 5];\n                                case 5: return [3 /*break*/, 7];\n                                case 6:\n                                    console.error(\"Unable to load PWA Element 'pwa-camera-modal'. See the docs: https://capacitorjs.com/docs/pwa-elements.\");\n                                    this.fileInputExperience(options, resolve);\n                                    _a.label = 7;\n                                case 7: return [2 /*return*/];\n                            }\n                        });\n                    }); })];\n            });\n        });\n    };\n    CameraPluginWeb.prototype.fileInputExperience = function (options, resolve) {\n        var input = document.querySelector('#_capacitor-camera-input');\n        var cleanup = function () {\n            input.parentNode && input.parentNode.removeChild(input);\n        };\n        if (!input) {\n            input = document.createElement('input');\n            input.id = '_capacitor-camera-input';\n            input.type = 'file';\n            document.body.appendChild(input);\n        }\n        input.accept = 'image/*';\n        input.capture = true;\n        if (options.source === CameraSource.Photos || options.source === CameraSource.Prompt) {\n            input.removeAttribute('capture');\n        }\n        else if (options.direction === CameraDirection.Front) {\n            input.capture = 'user';\n        }\n        else if (options.direction === CameraDirection.Rear) {\n            input.capture = 'environment';\n        }\n        input.addEventListener('change', function (_e) {\n            var file = input.files[0];\n            var format = 'jpeg';\n            if (file.type === 'image/png') {\n                format = 'png';\n            }\n            else if (file.type === 'image/gif') {\n                format = 'gif';\n            }\n            if (options.resultType === CameraResultType.DataUrl || options.resultType === CameraResultType.Base64) {\n                var reader_1 = new FileReader();\n                reader_1.addEventListener('load', function () {\n                    if (options.resultType === CameraResultType.DataUrl) {\n                        resolve({\n                            dataUrl: reader_1.result,\n                            format: format\n                        });\n                    }\n                    else if (options.resultType === CameraResultType.Base64) {\n                        var b64 = reader_1.result.split(',')[1];\n                        resolve({\n                            base64String: b64,\n                            format: format\n                        });\n                    }\n                    cleanup();\n                });\n                reader_1.readAsDataURL(file);\n            }\n            else {\n                resolve({\n                    webPath: URL.createObjectURL(file),\n                    format: format\n                });\n                cleanup();\n            }\n        });\n        input.click();\n    };\n    CameraPluginWeb.prototype._getCameraPhoto = function (photo, options) {\n        return new Promise(function (resolve, reject) {\n            var reader = new FileReader();\n            var format = photo.type.split('/')[1];\n            if (options.resultType === CameraResultType.Uri) {\n                resolve({\n                    webPath: URL.createObjectURL(photo),\n                    format: format\n                });\n            }\n            else {\n                reader.readAsDataURL(photo);\n                reader.onloadend = function () {\n                    var r = reader.result;\n                    if (options.resultType === CameraResultType.DataUrl) {\n                        resolve({\n                            dataUrl: r,\n                            format: format\n                        });\n                    }\n                    else {\n                        resolve({\n                            base64String: r.split(',')[1],\n                            format: format\n                        });\n                    }\n                };\n                reader.onerror = function (e) {\n                    reject(e);\n                };\n            }\n        });\n    };\n    return CameraPluginWeb;\n}(WebPlugin));\nexport { CameraPluginWeb };\nvar Camera = new CameraPluginWeb();\nexport { Camera };\n//# sourceMappingURL=camera.js.map"]},"metadata":{},"sourceType":"module"}